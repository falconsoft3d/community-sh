from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import (
    InstanceViewSet, 
    InstanceListView, 
    InstanceCreateView, 
    InstanceDetailView,
    instance_deploy,
    instance_stop,
    instance_restart,
    instance_logs_api,
    instance_console_exec,
    instance_install_requirements,
    instance_configure_domain,
    instance_generate_ssl,
    instance_install_module,
    instance_update_name,
    instance_update_database_name,
    instance_update_security_password,
    instance_update_main_repo,
    instance_add_secondary_repo,
    instance_delete_secondary_repo,
    instance_delete,
    instance_duplicate,
    metrics_view,
    settings_view,
    run_auto_backups_view,
    about,
    generate_ssl_certificate,
    instance_backup,
    instance_restore,
    instance_backups_list,
    backup_download,
    backup_delete,
    backup_restore_action,
    backup_create_instance,
    user_list,
    user_create,
    user_edit,
    user_delete,
    user_profile,
    user_change_password,
    home,
    dashboard,
    blog_list,
    blog_detail
)
from .auth_views import register, custom_login
from .two_factor_views import two_factor_setup, two_factor_verify
from .container_views import (
    container_list,
    container_create,
    container_detail,
    container_start,
    container_stop,
    container_restart,
    container_delete
)

router = DefaultRouter()
router.register(r'api/instances', InstanceViewSet, basename='api-instance')

urlpatterns = [
    path('accounts/register/', register, name='register'),
    path('accounts/login/', custom_login, name='login'),
    path('accounts/', include('django.contrib.auth.urls')),
    path('two-factor/setup/', two_factor_setup, name='two-factor-setup'),
    path('two-factor/verify/', two_factor_verify, name='two-factor-verify'),
    path('', home, name='home'),
    path('blog/', blog_list, name='blog-list'),
    path('blog/<slug:slug>/', blog_detail, name='blog-detail'),
    
    # Dashboard routes (protected area)
    path('dashboard/instances/', InstanceListView.as_view(), name='instance-list'),
    path('dashboard/instance/new/', InstanceCreateView.as_view(), name='instance-create'),
    path('dashboard/instance/<int:pk>/', InstanceDetailView.as_view(), name='instance-detail'),
    
    # Container routes
    path('dashboard/containers/', container_list, name='container-list'),
    path('dashboard/container/new/', container_create, name='container-create'),
    path('dashboard/container/<int:pk>/', container_detail, name='container-detail'),
    path('dashboard/container/<int:pk>/start/', container_start, name='container-start'),
    path('dashboard/container/<int:pk>/stop/', container_stop, name='container-stop'),
    path('dashboard/container/<int:pk>/restart/', container_restart, name='container-restart'),
    path('dashboard/container/<int:pk>/delete/', container_delete, name='container-delete'),
    path('dashboard/instance/<int:pk>/deploy/', instance_deploy, name='instance-deploy'),
    path('dashboard/instance/<int:pk>/stop/', instance_stop, name='instance-stop'),
    path('dashboard/instance/<int:pk>/restart/', instance_restart, name='instance-restart'),
    path('dashboard/instance/<int:pk>/delete/', instance_delete, name='instance-delete'),
    path('dashboard/instance/<int:pk>/duplicate/', instance_duplicate, name='instance-duplicate'),
    path('dashboard/instance/<int:pk>/backup/', instance_backup, name='instance-backup'),
    path('dashboard/instance/<int:pk>/backups/', instance_backups_list, name='instance-backups'),
    path('dashboard/instance/<int:pk>/restore/', instance_restore, name='instance-restore'),
    path('dashboard/backup/<int:backup_id>/download/', backup_download, name='backup-download'),
    path('dashboard/backup/<int:backup_id>/delete/', backup_delete, name='backup-delete'),
    path('dashboard/backup/<int:backup_id>/restore/', backup_restore_action, name='backup-restore-action'),
    path('dashboard/backup/<int:backup_id>/create-instance/', backup_create_instance, name='backup-create-instance'),
    path('dashboard/instance/<int:pk>/logs/', instance_logs_api, name='instance-logs-api'),
    path('dashboard/instance/<int:pk>/console/', instance_console_exec, name='instance-console-exec'),
    path('dashboard/instance/<int:pk>/install-requirements/', instance_install_requirements, name='instance-install-requirements'),
    path('dashboard/instance/<int:pk>/configure-domain/', instance_configure_domain, name='instance-configure-domain'),
    path('dashboard/instance/<int:pk>/generate-ssl/', instance_generate_ssl, name='instance-generate-ssl'),
    path('dashboard/instance/<int:pk>/install-module/', instance_install_module, name='instance-install-module'),
    path('dashboard/instance/<int:pk>/update-name/', instance_update_name, name='instance-update-name'),
    path('dashboard/instance/<int:pk>/update-database-name/', instance_update_database_name, name='instance-update-database-name'),
    path('dashboard/instance/<int:pk>/update-security-password/', instance_update_security_password, name='instance-update-security-password'),
    path('dashboard/instance/<int:pk>/update-main-repo/', instance_update_main_repo, name='instance-update-main-repo'),
    path('dashboard/instance/<int:pk>/add-secondary-repo/', instance_add_secondary_repo, name='instance-add-secondary-repo'),
    path('dashboard/instance/<int:pk>/delete-secondary-repo/<int:repo_id>/', instance_delete_secondary_repo, name='instance-delete-secondary-repo'),
    path('dashboard/metrics/', metrics_view, name='metrics'),
    path('dashboard/settings/', settings_view, name='settings'),
    path('dashboard/settings/generate-ssl/', generate_ssl_certificate, name='generate-ssl'),
    path('dashboard/settings/run-auto-backups/', run_auto_backups_view, name='run-auto-backups'),
    path('dashboard/about/', about, name='about'),
    path('dashboard/users/', user_list, name='user-list'),
    path('dashboard/users/new/', user_create, name='user-create'),
    path('dashboard/users/<int:user_id>/edit/', user_edit, name='user-edit'),
    path('dashboard/users/<int:user_id>/delete/', user_delete, name='user-delete'),
    path('dashboard/profile/', user_profile, name='user-profile'),
    path('dashboard/profile/change-password/', user_change_password, name='change-password'),
    
    path('', include(router.urls)),
]
