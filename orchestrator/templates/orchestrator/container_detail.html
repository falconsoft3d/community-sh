{% extends "orchestrator/base.html" %}

{% block content %}
<div class="flex flex-col gap-6 max-w-6xl">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="{% url 'container-list' %}"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10">
                <i data-lucide="arrow-left" class="h-4 w-4"></i>
            </a>
            <div>
                <h1 class="text-3xl font-bold tracking-tight">{{ container.name }}</h1>
                <p class="text-muted-foreground mt-1">{{ container.get_template_display }}</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            {% if container.status == 'stopped' %}
            <a href="{% url 'container-start' container.pk %}"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-green-600 text-white hover:bg-green-700 h-10 px-4 py-2">
                <i data-lucide="play" class="mr-2 h-4 w-4"></i> Start
            </a>
            {% elif container.status == 'running' %}
            <a href="{% url 'container-restart' container.pk %}"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                <i data-lucide="rotate-cw" class="mr-2 h-4 w-4"></i> Restart
            </a>
            <a href="{% url 'container-stop' container.pk %}"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-yellow-600 text-white hover:bg-yellow-700 h-10 px-4 py-2">
                <i data-lucide="square" class="mr-2 h-4 w-4"></i> Stop
            </a>
            {% endif %}
            <form method="post" action="{% url 'container-delete' container.pk %}"
                onsubmit="return confirm('Are you sure you want to delete this container? This action cannot be undone.');">
                {% csrf_token %}
                <button type="submit"
                    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2">
                    <i data-lucide="trash-2" class="mr-2 h-4 w-4"></i> Delete
                </button>
            </form>
        </div>
    </div>

    {% if messages %}
    {% for message in messages %}
    <div
        class="rounded-md {% if message.tags == 'success' %}bg-green-50 border border-green-200{% else %}bg-red-50 border border-red-200{% endif %} p-3">
        <div class="flex items-center gap-2">
            <i data-lucide="{% if message.tags == 'success' %}check-circle{% else %}alert-circle{% endif %}"
                class="h-4 w-4 {% if message.tags == 'success' %}text-green-600{% else %}text-red-600{% endif %}"></i>
            <span class="text-sm {% if message.tags == 'success' %}text-green-800{% else %}text-red-800{% endif %}">{{
                message }}</span>
        </div>
    </div>
    {% endfor %}
    {% endif %}

    <div class="grid md:grid-cols-2 gap-6">
        <!-- Container Info -->
        <div class="rounded-xl border bg-card text-card-foreground shadow-sm">
            <div class="p-6 border-b">
                <h3 class="font-semibold text-lg">Container Information</h3>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Status</span>
                    <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold
                        {% if container.status == 'running' %}bg-green-50 text-green-700 border-green-200
                        {% elif container.status == 'stopped' %}bg-gray-50 text-gray-700 border-gray-200
                        {% elif container.status == 'creating' %}bg-blue-50 text-blue-700 border-blue-200
                        {% else %}bg-red-50 text-red-700 border-red-200{% endif %}">
                        {{ container.get_status_display }}
                    </span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Image</span>
                    <span class="text-sm font-mono">{{ container.image }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Host Port</span>
                    <span class="text-sm font-mono">{{ container.port }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Container Port</span>
                    <span class="text-sm font-mono">{{ container.container_port }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Network</span>
                    <span class="text-sm font-mono">{{ container.network }}</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-muted-foreground">Traefik URL</span>
                    <span class="text-sm font-mono text-primary">{{ container.url }}</span>
                </div>
                {% if container.status == 'running' %}
                <div class="pt-4 border-t space-y-2">
                    <a href="{{ container.url }}" target="_blank"
                        class="w-full inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                        <i data-lucide="external-link" class="mr-2 h-4 w-4"></i>
                        Open via Traefik
                    </a>
                    <a href="http://localhost:{{ container.port }}" target="_blank"
                        class="w-full inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                        <i data-lucide="link" class="mr-2 h-4 w-4"></i>
                        Open Direct Port
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Environment Variables -->
        <div class="rounded-xl border bg-card text-card-foreground shadow-sm">
            <div class="p-6 border-b">
                <h3 class="font-semibold text-lg">Environment Variables</h3>
            </div>
            <div class="p-6">
                {% if container.environment %}
                <div class="space-y-2">
                    {% for key, value in container.environment.items %}
                    <div class="flex items-center justify-between text-sm">
                        <span class="font-mono text-muted-foreground">{{ key }}</span>
                        <span class="font-mono">{{ value }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-muted-foreground">No environment variables configured</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Logs -->
    {% if logs %}
    <div class="rounded-xl border bg-card text-card-foreground shadow-sm">
        <div class="p-6 border-b">
            <h3 class="font-semibold text-lg">Container Logs (Last 50 lines)</h3>
        </div>
        <div class="p-6">
            <pre
                class="bg-black text-green-400 p-4 rounded-lg overflow-x-auto text-xs font-mono max-h-96 overflow-y-auto">{{ logs }}</pre>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}